

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>run on your machine &mdash; solid_dmft  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running solid_dmft on a cluster" href="run_cluster.html" />
    <link rel="prev" title="Docker" href="docker.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
          

          
            <a href="../index.html" class="icon icon-home"> solid_dmft
          

          
            
            <img src="../_static/logo_no_text.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#module-reference-manual">module reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/csc_flow.html">CSC flow module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dft_managers.html">dft managers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/dft_managers/qe_manager.html">qe_manager.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dft_managers/vasp_manager.html">vasp_manager.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dmft_cycle.html">dmft cycle module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/dmft_tools.html">dmft tools modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/afm_mapping.html">afm_mapping.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/convergence.html">convergence.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/formatter.html">formatter.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/gf_mixer.html">greens_function_mixer.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/initial_sigma.html">initial_self_energies.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/interaction_ham.html">interaction_hamiltonian.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/legendre_filter.html">legendre_filter.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/manipulate_mu.html">manipulate_chemical_potential.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/observables.html">observables.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/results_arch.html">results_to_archive.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/dmft_tools/solver.html">solver.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/postprocessing.html">postprocessing tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/postprocessing/make_spaghetti.html">make_spaghetti.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/postprocessing/maxent_gf_imp.html">maxent_gf_imp.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/postprocessing/maxent_gf_latt.html">maxent_gf_latt.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/postprocessing/maxent_sigma.html">maxent_sigma.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/postprocessing/postproc_plotbands.html">postproc_plotbands.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/read_config.html">read config parser</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/read_config.html#general">general</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/read_config.html#solver">solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/read_config.html#dft">dft</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/read_config.html#advanced">advanced</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/util.html">util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/util/symmetrize_gamma_file.html">symmetrize_gamma_file.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/util/update_dmft_config.html">update_dmft_config.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/util/update_results_h5.html">update_results_h5.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/util/write_kslice_to_h5.html">write_kslice_to_h5.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#dft-code-interfaces">DFT code interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="w90_interface.html">Wannier90 interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="w90_interface.html#orbital-order-in-the-w90-converter">orbital order in the W90 converter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="vasp_csc.html">interface to VASP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="vasp_csc.html#general-remarks">General remarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="vasp_csc.html#locproj-bug-for-individual-projections">LOCPROJ bug for individual projections:</a></li>
<li class="toctree-l4"><a class="reference internal" href="vasp_csc.html#convergence-of-projectors-with-vasp">convergence of projectors with Vasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="vasp_csc.html#enabling-csc-calculations-with-wannier90-projectors">Enabling CSC calculations with Wannier90 projectors</a></li>
<li class="toctree-l4"><a class="reference internal" href="vasp_csc.html#speeding-up-by-not-writing-projectors-at-every-step">Speeding up by not writing projectors at every step</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#run-solid-dmft">run solid_dmft</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="docker.html">Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="docker.html#building-the-docker-image">Building the docker image</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker.html#pulling-a-docker-image">Pulling a docker image</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker.html#getting-docker-images-onto-cscs-daint">Getting docker images onto CSCS daint</a></li>
<li class="toctree-l4"><a class="reference internal" href="docker.html#running-a-docker-container">Running a docker container</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">run on your machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#csc-calculations-locally">CSC calculations locally</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="run_cluster.html">Running solid_dmft on a cluster</a><ul>
<li class="toctree-l4"><a class="reference internal" href="run_cluster.html#running-on-cscs-daint">Running on CSCS daint</a></li>
<li class="toctree-l4"><a class="reference internal" href="run_cluster.html#one-shot-job-on-daint">one shot job on daint</a></li>
<li class="toctree-l4"><a class="reference internal" href="run_cluster.html#csc-calculations-on-daint">CSC calculations on daint</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/CaFeO3_csc_plo/tutorial.html">CaFeO3 CSC with VASP PLOs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/CaFeO3_csc_plo/tutorial.html#Running-the-initial-SCF-DFT-calculation-(~-1-core-hour)">Running the initial SCF DFT calculation (~ 1 core hour)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/CaFeO3_csc_plo/tutorial.html#Input-files-for-CSC-DMFT-calculations">Input files for CSC DMFT calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/CaFeO3_csc_plo/tutorial.html#Running-the-CSC-DMFT-calculations">Running the CSC DMFT calculations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-3-0-0">Version 3.0.0</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">solid_dmft</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../documentation.html">documentation</a> &raquo;</li>
        
      <li>run on your machine</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/md_notes/run_locally.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="run-on-your-machine">
<h1>run on your machine<a class="headerlink" href="#run-on-your-machine" title="Permalink to this headline">¶</a></h1>
<div class="section" id="csc-calculations-locally">
<h2>CSC calculations locally<a class="headerlink" href="#csc-calculations-locally" title="Permalink to this headline">¶</a></h2>
<p>Here one needs a special docker image with vasp included. This can be done by
building the Dockerfile in <code class="docutils literal notranslate"><span class="pre">/Docker</span></code>.
Then start this docker image as done above and go to the directory with all
necessary input files (start with <code class="docutils literal notranslate"><span class="pre">svo-csc</span></code> example). You need a pre-converged
CHGCAR and preferably a WAVECAR, a set of INCAR, POSCAR, KPOINTS and POTCAR
files, the PLO cfg file <code class="docutils literal notranslate"><span class="pre">plo.cfg</span></code> and the usual DMFT input file
<code class="docutils literal notranslate"><span class="pre">dmft_config.ini</span></code>, which specifies the number of ranks for the DFT code and the DFT code executable in the <code class="docutils literal notranslate"><span class="pre">[dft]</span></code> section.</p>
<p>The whole machinery is started by calling <code class="docutils literal notranslate"><span class="pre">solid_dmft.py</span></code> as for one-shot calculations. Importantly the flag <code class="docutils literal notranslate"><span class="pre">csc</span> <span class="pre">=</span> <span class="pre">True</span></code> has to be set in the general section in the config file. Then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">n</span> <span class="mi">12</span> <span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">solid_dmft</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The programm will then run the <code class="docutils literal notranslate"><span class="pre">csc_flow_control</span></code> routine, which starts VASP accordingly by spawning a new child process. After VASP is finished it will run the converter, run the dmft_cycle, and then VASP again until the given
limit of DMFT iterations is reached. This should also work on most HPC systems (tested on slurm with OpenMPI), as the the child mpirun call is performed without the slurm environment variables. This tricks slrum into starting more ranks than it has available. Note, that maybe a slight adaption of the environment variables is needed to make sure VASP is found on the second node. The variables are stored <code class="docutils literal notranslate"><span class="pre">args</span></code> in the function <code class="docutils literal notranslate"><span class="pre">start_vasp_from_master_node</span></code> of the module <code class="docutils literal notranslate"><span class="pre">csc_flow.py</span></code></p>
<p>One remark regarding the number of iterations per DFT cycle. Since VASP uses a
block Davidson scheme for minimizing the energy functional not all eigenvalues
of the Hamiltonian are updated simultaneously therefore one has to make several
iterations before the changes from DMFT in the charge density are completely
considered. The default value are <strong>6</strong> DFT iterations, which is very
conservative, and can be changed by changing the config parameter <code class="docutils literal notranslate"><span class="pre">n_iter</span></code> in the <code class="docutils literal notranslate"><span class="pre">[dft]</span></code> section. In general one should use <code class="docutils literal notranslate"><span class="pre">IALGO=90</span></code> in VASP, which performs an exact diagonalization rather than a partial diagonalization scheme, but this is very slow for larger systems.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="run_cluster.html" class="btn btn-neutral float-right" title="Running solid_dmft on a cluster" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="docker.html" class="btn btn-neutral float-left" title="Docker" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Copyright (C) 2018-2020, ETH Zurich Copyright (C) 2021, The Simons Foundation authors: A. Hampel, M. Merkel, and S. Beck.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>